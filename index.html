<!DOCTYPE html>
<html lang="fr">	
<head>
	<title>TBK tour</title>
	<meta charset="utf-8">
	<meta name="robots" content="noindex" />
	<link rel="stylesheet" href="styles/styles.css" type="text/css">
	<script type="text/javascript" src="js/menu.js"></script>
	<style>
		body { margin: 0; overflow: hidden; background-color: #000; }
		.tm  { position: absolute; top: 10px; right: 10px; }
    </style>	
	<script src="http://threejs.org/build/three.min.js"></script>
	<script src="js/CustomOrbitControls.js"></script>
	<script src="js/Detector.js"></script>	
</head>

<body>

<div id="toolbar">

<ul id="menu">
	<li><a>Cluny</a>
		<ul>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>Le Cloître</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>Le clocher de l'eau bénite</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>La tour ronde</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>Le tilleul d'Abélard</a></li>	
			<li><a href="#" onclick='switchValue(this.innerHTML);'>Le "Pipelet"</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>L'Abbaye</a></li>
		</ul>
	</li>

	<li><a>Paris</a>
		<ul>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>L'hôtel d'Iena</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>Les Salon d'Iena</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>L'Opéra Garnier</a></li>
			<li><a href="#" onclick='switchValue(this.innerHTML);'>La Madeleine</a></li>
		</ul>
	</li>
	
	<li><a>Aix en Provence</a>
	</li>

</ul>

</div>

	<a class="image" onclick="cacher()">
		<img src="images/question.png" alt="Histoire" id="question" />
	</a>
	
	<div id = "encart">
		<div id = "bandeau"><h3>La zacar'sss</h3></div>	
		<div id = "texte">
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur tincidunt placerat felis, vel laoreet massa laoreet quis. Proin ac eros ut elit imperdiet convallis. Fusce dapibus tortor at dui semper convallis. Mauris vel dui vitae ante fermentum sagittis eget id purus. Proin sed leo pharetra, dapibus sem eget, tempus magna. Etiam mollis erat nec nisl sollicitudin pulvinar. Aliquam erat volutpat. Fusce in nibh at eros consectetur dignissim id ac neque. Pellentesque imperdiet, nisi ac hendrerit accumsan, orci urna posuere ligula, congue faucibus nisl leo eget massa. Duis euismod, nisi condimentum consequat dapibus, lectus diam iaculis magna, non tincidunt erat nibh vitae est. Phasellus et enim in leo condimentum volutpat.</p>
			<p>Duis ac mi justo. Nam vitae nibh dignissim, molestie tellus sed, faucibus nulla. Duis eget laoreet nunc, ac luctus tellus. Fusce blandit urna sed augue pretium, non viverra nibh gravida. Quisque laoreet lacinia leo, a ornare tortor scelerisque et. Proin laoreet convallis lobortis. Ut ultrices dictum feugiat. Interdum et malesuada fames ac ante ipsum primis in faucibus. Vestibulum dignissim interdum molestie. Integer dignissim pretium urna porta convallis. Suspendisse lectus metus, venenatis nec felis quis, fringilla tempus ante. Integer tortor odio, lobortis id consequat et, sodales eu lorem. Donec quam quam, cursus.</p>
			<p>Duis ac mi justo. Nam vitae nibh dignissim, molestie tellus sed, faucibus nulla. Duis eget laoreet nunc, ac luctus tellus. Fusce blandit urna sed augue pretium, non viverra nibh gravida. Quisque laoreet lacinia leo, a ornare tortor scelerisque et. Proin laoreet convallis lobortis. Ut ultrices dictum feugiat. Interdum et malesuada fames ac ante ipsum primis in faucibus. Vestibulum dignissim interdum molestie. Integer dignissim pretium urna porta convallis. Suspendisse lectus metus, venenatis nec felis quis, fringilla tempus ante. Integer tortor odio, lobortis id consequat et, sodales eu lorem. Donec quam quam, cursus.</p>
		</div>
	</div>


	<div id="sphere"></div>	
	<script>
		
		var encart = 1;

		function cacher()
		{
			if( encart == 1 ) {
				// on cache l'encart et sa molette
				document.getElementById('encart').style.visibility = "hidden";
				document.getElementById('encart').style.overflow = "hidden";
				encart = 0;
				} else {
					// on réaffiche l'encart et sa molette
					document.getElementById('encart').style.visibility = "visible";
					document.getElementById('encart').style.overflow = "scroll";
					encart = 1;
				}
		}

		var webglEl = document.getElementById('sphere');

		var width  = window.innerWidth,
			height = window.innerHeight;
		var windowWidth, 
			windowHeight;
		var rotateSpeed = -0.5;

		var scene = new THREE.Scene();

		var camera = new THREE.PerspectiveCamera(75, width / height, 1, 1000);
		camera.position.x = 0.1;

		var renderer = Detector.webgl ? new THREE.WebGLRenderer() : new THREE.CanvasRenderer();
		renderer.setSize(width, height);

		var geometry = new THREE.SphereGeometry(100, 50, 50);
	
		var texturesHD = ['photospheres/cluny_cloitre.jpg',
						  'photospheres/cluny_transept.jpg',
						  'photospheres/cluny_zaronde.jpg',
						  'photospheres/cluny_zabels.jpg',
						  'photospheres/cluny_pips.jpg',
						  'photospheres/cluny_circuitmh.jpg'
		];
		
		var texturesSD = ['photospheres/cluny_cloitre_sd.jpg',
						  'photospheres/cluny_transept_sd.jpg',
						  'photospheres/cluny_zaronde_sd.jpg',
						  'photospheres/cluny_zabels_sd.jpg',
						  'photospheres/cluny_pips_sd.jpg',
						  'photospheres/cluny_circuitmh_sd.jpg'
		];
		
		var resHD = 50, resSD = 20;
		
		var currentMesh	= null
		function switchValue(type){
		currentMesh && scene.remove(currentMesh)
		
		bandeau.innerHTML = "<h3>" + type + "</h3>";
		
		if( type === "Le Cloître" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_cloitre.jpg')});
		}else if( type === "Le clocher de l'eau bénite" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_transept.jpg')});
		}else if( type === "La tour ronde" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_zaronde.jpg')});		
		}else if( type === "Le tilleul d'Abélard" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_zabels.jpg')});		
		}else if( type === "Le \"Pipelet\"" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_pips.jpg')});		
		}else if( type === "L'Abbaye" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/cluny_circuitmh.jpg')});
		}else if( type === "L'hôtel d'Iena" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/p3_iena.jpg')});
		}else if( type === "Les Salon d'Iena" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/p3_iena_salon_2.jpg')});
		}else if( type === "L'Opéra Garnier" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/p3_opera.jpg')});
		}else if( type === "La Madeleine" ){
				var mesh = new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('photospheres/p3_madeleine_2.jpg')});				
		}else	console.assert(false)
			var sphere = new THREE.Mesh(geometry, mesh);
			sphere.scale.x = -1;
			scene.add(sphere)
			currentMesh	= sphere
			location.hash	= type
		}
		var initialType	= location.hash.substr(1)	|| "Le Cloître"
		switchValue(initialType)
		
			
		scene.add(sphere);

		
		var controls = new THREE.OrbitControls(camera);
		controls.noPan = true;
		controls.noZoom = true; 
		controls.autoRotate = true;
		controls.autoRotateSpeed = rotateSpeed;

		webglEl.appendChild(renderer.domElement);

		render();

		function render() {
			updateSize();
			controls.update();
			requestAnimationFrame(render);
			renderer.render(scene, camera);
		}





		// Fonction qui met à jours les tailles des cadres si on redimensionne la fenêtre
		function updateSize() {

			if (windowWidth != window.innerWidth
					|| windowHeight != window.innerHeight) {

				windowWidth = window.innerWidth;
				windowHeight = window.innerHeight;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(windowWidth, windowHeight);

			}

		}


		function onMouseWheel(event) {
			event.preventDefault();
			
			if (event.wheelDeltaY) { // WebKit
				camera.fov -= event.wheelDeltaY * 0.05;
			} else if (event.wheelDelta) { 	// Opera / IE9
				camera.fov -= event.wheelDelta * 0.05;
			} else if (event.detail) { // Firefox
				camera.fov += event.detail * 1.0;
			}

			camera.fov = Math.max(40, Math.min(100, camera.fov));
			camera.updateProjectionMatrix();
		}

		document.addEventListener('mousewheel', onMouseWheel, false);
		document.addEventListener('DOMMouseScroll', onMouseWheel, false);

	</script>
</body>
</html>
